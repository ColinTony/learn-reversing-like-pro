FROM --platform=linux/386 i386/debian:bullseye

# Actualiza e instala solo lo necesario
RUN dpkg --add-architecture i386 && \
    apt-get update && \
    apt-get install -y \
    gcc \
    gdb \
    make \
    binutils \
    libc6-dev \
    build-essential \
    net-tools \
    vim \
    nano \
    file \
    strace \
    sudo \
    wget \
    git \
    curl \
    python

#pwndbg
RUN curl -qsL 'https://install.pwndbg.re' | sh -s -- -t pwndbg-gdb

# === Protostar stack binaries with SUID ===
RUN mkdir -p /opt/protostar/bin
COPY ./WarGames/protostar_build/protostar/bin/stack* /opt/protostar/bin/
# Propietario root y SUID (rws para root)
RUN chown root:root /opt/protostar/bin/
RUN chmod 4755 /opt/protostar/bin/stack*

# ==========================================
# RADARE
# ===== RADARE2 (build from source, bullseye i386) =====
RUN apt-get update && apt-get install -y --no-install-recommends git ca-certificates curl build-essential pkg-config meson ninja-build python3 python3-pip libssl-dev libzip-dev zlib1g-dev liblz4-dev && rm -rf /var/lib/apt/lists/*

RUN git clone --depth 1 https://github.com/radareorg/radare2 /tmp/radare2  && cd /tmp/radare2  && sys/install.sh  && rm -rf /tmp/radare2
RUN useradd -m -s /bin/bash testing
WORKDIR /share
#Pythoin
RUN wget https://bootstrap.pypa.io/pip/2.7/get-pip.py
RUN python ./get-pip.py

USER testing
# Deja listo el contenedor para compilar binarios vulnerables
CMD ["/bin/bash"]
